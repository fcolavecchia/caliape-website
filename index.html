---
layout: default
title: Inicio
description: Calíape - Aplicación móvil de IA médica que automatiza la generación de historias clínicas y humaniza la atención médica.
---

<section class="hero">
    <div class="container hero-container">
        <div class="hero-content">
            <h1>Calíape humaniza la atención médica</h1>
            <p class="hero-subtitle">Revolucionando la consulta médica con inteligencia artificial</p>
            <p class="hero-description">
                La primera aplicación móvil de IA médica que automatiza la generación de historias clínicas, 
                permitiendo que los profesionales se enfoquen completamente en la atención del paciente.
            </p>
            <div class="cta-buttons">
                <a href="#caracteristicas" class="btn btn-primary">Conocer más</a>
                <a href="{{ '/blog.html' | relative_url }}" class="btn btn-secondary">Ver blog</a>
            </div>
        </div>
        <div class="hero-image">
            <img src="{{ '/assets/images/pacientes.png' | relative_url }}" alt="Aplicación Calíape">
        </div>
    </div>
</section>

<section id="caracteristicas" class="features">
    <div class="container">
        <h2>Características principales</h2>
        <div class="features-grid">
            <div class="feature-card">
                <h3>Transcripción automática</h3>
                <p>Registra la conversación médico-paciente y genera documentación clínica estructurada automáticamente.</p>
            </div>
            <div class="feature-card">
                <h3>Historias clínicas inteligentes</h3>
                <p>Genera resúmenes clínicos precisos para el seguimiento profesional del paciente.</p>
            </div>
            <div class="feature-card">
                <h3>Indicaciones para el paciente</h3>
                <p>Traduce las indicaciones médicas a un lenguaje amigable y las envía directamente al paciente.</p>
            </div>
            <div class="feature-card">
                <h3>Seguridad médica</h3>
                <p>Cifrado end-to-end y protección absoluta de datos médicos sensibles.</p>
            </div>
        </div>
    </div>
</section>

<!-- Sección de invitación a pruebas beta -->
<section id="beta" class="beta-invite">
    <div class="container">
        <h2>Unite a nuestra prueba beta</h2>
        <p>¿Sos profesional de la salud interesado en transformar tu consulta médica? 
           Sumate a nuestra prueba beta exclusiva y sé de los primeros en experimentar Calíape.</p>
        
        <form class="beta-form" id="betaForm">
            <h3 class="form-section-title">Datos requeridos</h3>
            <input 
                type="text" 
                name="nombre" 
                placeholder="Nombre"
                required
                aria-label="Nombre">
            <input 
                type="text" 
                name="apellido" 
                placeholder="Apellido"
                required
                aria-label="Apellido">
            <input
                type="email"
                name="email"
                placeholder="Email del teléfono (Apple ID / Google)"
                required
                aria-label="Email del teléfono">
                <!-- <p class="form-helper-text" id="emailHelpText">
                Usá el email con el que tenés logueado tu teléfono.  
                Es el que necesitamos para darte acceso a la app.
                </p>                 -->
            <input 
                type="text" 
                name="especialidad" 
                placeholder="Especialidad médica"
                required
                aria-label="Especialidad médica">
            <input 
                type="text" 
                name="hospital" 
                placeholder="Institución donde trabajás habitualmente"
                required
                aria-label="Institución donde trabajás habitualmente">
            <input 
                type="text" 
                name="lugar" 
                placeholder="Ciudad, provincia, país"
                required
                aria-label="Ciudad, provincia, país">
            <!-- <div class="field-reading-order"> -->
                <p class="form-helper-text">Cómo te enteraste de Calíape? *</p>
                <select name="referido" aria-label="Cómo te enteraste de Calíape?" required aria-required="true">
                    <option value="" disabled selected hidden>Seleccioná una opción</option>
                    <option value="LinkedIn">LinkedIn</option>
                    <option value="Otras redes sociales">Otras redes sociales</option>
                    <option value="Noticias (web, diarios, streaming, radio, etc.)">Noticias (web, diarios, streaming, radio, etc.)</option>
                    <option value="Congreso o evento médico">Congreso o evento médico</option>
                    <option value="Referido por colegas">Referido por colegas</option>
                    <!-- <option value="Artículo o blog">Artículo o blog</option> -->
                    <option value="Otro">Otro</option>
                </select>
            <!-- </div> -->
            
            <h3 class="form-section-title">Datos opcionales</h3>
            <input 
                type="text" 
                name="edad" 
                placeholder="Edad"
                aria-label="Edad">
            <div class="input-with-tooltip">
                <span class="tooltip-icon" tabindex="0">
                    ?
                    <span class="tooltip-text">Es el número de registro profesional otorgado por el colegio o consejo profesional de tu jurisdicción.</span>
                </span>
                <input 
                    type="text" 
                    name="matricula" 
                    placeholder="Matrícula profesional"
                    aria-label="Matrícula profesional">
            </div>            
            <p class="form-helper-text">Recibí las noticias de Calíape en WhatsApp: </p>
            <div class="input-with-tooltip">
                <span class="tooltip-icon" tabindex="1">
                    ?
                    <span class="tooltip-text">Incluí el código de país y área. <br>Ejemplo: +54 9 11 1234-5678</span>
                </span>                
                <input 
                type="tel" 
                name="telefono" 
                placeholder="Celular"
                aria-label="Celular">                
            </div>
            
            <button type="submit" disabled>Solicitar acceso beta</button>
            <p class="form-disclaimer">No compartiremos esta información con terceros con ningún fin.</p>
        </form>
        <div id="betaTestPanel" style="display:none; margin-top: 1rem; text-align: center;">
            <p class="form-disclaimer">Panel de pruebas (solo en local)</p>
            <label style="display:inline-flex; align-items:center; gap:0.5rem; margin-bottom:0.75rem; color:#fff; font-size:0.8rem;">
                <input type="checkbox" id="betaTestSendReal">
                Enviar a Google Forms (real)
            </label>
            <div style="display:flex; flex-wrap:wrap; gap:0.5rem; justify-content:center;">
                <button type="button" id="betaTestRequiredOnly" class="btn btn-secondary">Test: solo requeridos</button>
                <button type="button" id="betaTestAllFields" class="btn btn-secondary">Test: todos los campos</button>
                <button type="button" id="betaTestWhitespace" class="btn btn-secondary">Test: opcionales con espacios</button>
                <button type="button" id="betaTestRunAll" class="btn btn-primary">Test: correr todos</button>
            </div>
        </div>
        <div id="formMessage" class="beta-form-message"></div>
    </div>
</section>

<script>
// Tooltip functionality for touch devices
document.addEventListener('DOMContentLoaded', function() {
    const tooltipIcons = document.querySelectorAll('.tooltip-icon');
    
    tooltipIcons.forEach(function(icon) {
        icon.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Close other tooltips
            tooltipIcons.forEach(function(otherIcon) {
                if (otherIcon !== icon) {
                    otherIcon.classList.remove('active');
                }
            });
            
            // Toggle this tooltip
            this.classList.toggle('active');
        });
    });
    
    // Close tooltip when clicking outside
    document.addEventListener('click', function() {
        tooltipIcons.forEach(function(icon) {
            icon.classList.remove('active');
        });
    });
});

const betaForm = document.getElementById('betaForm');
const isLocalhost = ['localhost', '127.0.0.1'].includes(window.location.hostname);
const testMode = isLocalhost && window.BETA_FORM_TEST_MODE !== false;

if (betaForm) {
    betaForm.addEventListener('submit', async function(e) {
    e.preventDefault();

    if (!betaForm.checkValidity()) {
        const messageDiv = document.getElementById('formMessage');
        if (messageDiv) {
            messageDiv.textContent = 'Revisá los campos obligatorios antes de enviar.';
            messageDiv.className = 'beta-form-message error';
        }
        betaForm.reportValidity();
        return;
    }
    
    const formData = new FormData(this);
    const nombre = formData.get('nombre');
    const apellido = formData.get('apellido');
    const email = formData.get('email');
    const especialidad = formData.get('especialidad');
    const edad = formData.get('edad') || '';
    const matricula = formData.get('matricula') || '';
    const telefono = formData.get('telefono') || '';
    const hospital = formData.get('hospital') || '';
    const lugar = formData.get('lugar') || '';
    const referido = formData.get('referido') || '';

    // URL del Google Form con tu Form ID
    const googleFormURL = 'https://docs.google.com/forms/d/e/1FAIpQLSckceahCPzytS7G-rBsJo3TEN2jTFmSAFl-dDLOEqR-E4_8gQ/formResponse';
    

    // Entry IDs de tu Google Form
    const formBody = new URLSearchParams({
        'entry.1239758288': nombre,
        'entry.1589314304': apellido,
        'entry.213742462': email,
        'entry.678704696': especialidad,
        'entry.1737286529': hospital,
        'entry.1901642424': lugar,
        'entry.1505268358': referido
    });

    const addIfValue = (entryId, value) => {
        if (typeof value === 'string' && value.trim().length > 0) {
            formBody.append(entryId, value.trim());
        }else{}

    };

    addIfValue('entry.583972878', edad);
    addIfValue('entry.980961395', telefono);
    addIfValue('entry.2118862770', matricula);
    
    const messageDiv = document.getElementById('formMessage');
    
    if (testMode && !window.BETA_FORM_TEST_SEND) {
        console.log('TEST MODE - Payload:', Object.fromEntries(formBody.entries()));
        messageDiv.textContent = 'TEST MODE: solicitud simulada. Payload en consola.';
        messageDiv.className = 'beta-form-message success';
        betaForm.reset();
        return;
    }

    // fetch(googleFormURL, {
    //     method: 'POST',
    //     mode: 'no-cors',
    //     headers: {
    //         'Content-Type': 'application/x-www-form-urlencoded'
    //     },
    //     body: formBody
    // }).then(() => {
    //     messageDiv.textContent = '¡Gracias! Tu solicitud ha sido enviada correctamente.';
    //     messageDiv.className = 'beta-form-message success';
    //     betaForm.reset();
    // }).catch(() => {
    //     messageDiv.textContent = 'Hemos tenido un problema al recibir tu solicitud.';
    //     messageDiv.className = 'beta-form-message error';
    //     betaForm.reset();
    // });

    const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

    async function fetchJsonWithTimeout(url, options, timeoutMs = 8000) {
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), timeoutMs);

    try {
        const resp = await fetch(url, { ...options, signal: controller.signal });

        // Intentar parsear JSON pero sin romper si no hay body/JSON
        let data = {};
        const ct = resp.headers.get('content-type') || '';
        if (ct.includes('application/json')) {
        data = await resp.json().catch(() => ({}));
        } else {
        // a veces viene vacío o text/html: guardamos texto para debug
        const text = await resp.text().catch(() => '');
        data = text ? { raw: text } : {};
        }

        return { resp, data };
    } finally {
        clearTimeout(timeout);
    }
    }

    async function postLeadWithRetry(edgeURL, payload, attempts = 3) {
    let lastErr;

    for (let i = 0; i < attempts; i++) {
        const attemptNo = i + 1;

        try {
        const { resp, data } = await fetchJsonWithTimeout(
            edgeURL,
            {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
            },
            8000
        );

        if (resp.ok && data && data.ok) return { resp, data };

        // Determinar si vale reintentar
        const status = resp.status;
        const transient = status === 429 || status >= 500;

        // Log útil (antes del throw)
        console.error('Edge error:', { status, data });

        if (!transient) {
            // 4xx: error “definitivo” (payload/validación)
            throw new Error(data?.error || `Error ${status}`);
        }

        // Transitorio: reintentar
        throw new Error(`Transitorio ${status}`);
        } catch (e) {
        lastErr = e;

        // Si es el último intento, cortar
        if (i === attempts - 1) break;

        // Backoff + mensaje
        const backoff = [300, 900, 2000][i] ?? 2500;
        messageDiv.textContent = `Problema de conexión. Reintentando… (${attemptNo}/${attempts})`;
        messageDiv.className = 'beta-form-message';

        await sleep(backoff);
        }
    }

    throw lastErr;
    }



    const edgeURL = "https://cjwyjqklzrufnbtnzxfa.supabase.co/functions/v1/forward-to-google-form";

    const payload = {
    nombre,
    apellido,
    email,
    especialidad,
    hospital,
    lugar,
    referido,
    edad,
    telefono,
    matricula,
    };

    // --- UI: bloquear submit mientras envía ---
    const submitBtn = betaForm.querySelector('button[type="submit"]');
    if (submitBtn) submitBtn.disabled = true;

    messageDiv.textContent = 'Enviando solicitud…';
    messageDiv.className = 'beta-form-message';

    try {
    const { data } = await postLeadWithRetry(edgeURL, payload, 3);

    messageDiv.textContent = '¡Gracias! Tu solicitud fue enviada.';
    messageDiv.className = 'beta-form-message success';
    console.log('Solicitud enviada con éxito:', data);

    betaForm.reset();
    } catch (err) {
    console.error('Submit failed:', err);

    // Mensaje más humano: si fue abort/timeout, decilo
    const msg =
        (err && String(err).toLowerCase().includes('abort'))
        ? 'La conexión tardó demasiado. Probá de nuevo.'
        : 'No pudimos enviar la solicitud. Probá de nuevo.';

    messageDiv.textContent = msg;
    messageDiv.className = 'beta-form-message error';
    } finally {
    // Volver a habilitar (tu lógica de checkValidity lo va a ajustar igual)
    if (submitBtn) submitBtn.disabled = false;
    }


    // try {
    // const resp = await fetch(edgeURL, {
    //     method: "POST",
    //     headers: { "Content-Type": "application/json" },
    //     body: JSON.stringify(payload),
    // });

    // const data = await resp.json();

    // if (!resp.ok || !data.ok) {
    //     throw new Error("Falló el envío a Google Forms");
    //     console.error("Error response:", resp, "Data:", data);
    // }

    // messageDiv.textContent = "¡Gracias! Tu solicitud fue enviada.";
    // messageDiv.className = "beta-form-message success";
    // console.log("Solicitud enviada con éxito:", data);
    // betaForm.reset();
    // } catch (err) {
    // console.error(err);
    // messageDiv.textContent =
    //     "No pudimos enviar la solicitud. Probá de nuevo.";
    // messageDiv.className = "beta-form-message error";
    // }





    });
}

const updateSubmitState = () => {
    if (!betaForm) return;
    const submitBtn = betaForm.querySelector('button[type="submit"]');
    if (!submitBtn) return;
    const isValid = betaForm.checkValidity();
    submitBtn.disabled = !isValid;
    submitBtn.classList.toggle('is-disabled', !isValid);
};

if (betaForm) {
    updateSubmitState();
    betaForm.addEventListener('input', updateSubmitState);
    betaForm.addEventListener('change', updateSubmitState);
}

const setFieldValue = (name, value) => {
    if (!betaForm) return;
    const field = betaForm.querySelector(`[name="${name}"]`);
    if (field) {
        field.value = value;
        field.dispatchEvent(new Event('input', { bubbles: true }));
        field.dispatchEvent(new Event('change', { bubbles: true }));
    }
};

const baseRequired = {
    nombre: 'TestNombre',
    apellido: 'TestApellido',
    email: 'test@example.com',
    especialidad: 'Gastroenterología',
    hospital: 'Hospital Central',
    lugar: 'CABA, Argentina',
    referido: 'LinkedIn'
};

const testCases = {
    requiredOnly: {
        ...baseRequired,
        edad: '',
        telefono: '',
        matricula: ''
    },
    allFields: {
        ...baseRequired,
        hospital: 'Hospital Central',
        lugar: 'CABA, Argentina',
        referido: 'LinkedIn',
        edad: '38',
        telefono: '+54 9 11 1234-5678',
        matricula: 'MP-12345'
    },
    whitespaceOptional: {
        ...baseRequired,
        edad: '   ',
        telefono: '   ',
        matricula: '   '
    }
};

window.runBetaTestCase = (caseName) => {
    const testData = testCases[caseName];
    if (!betaForm || !testData) return;
    Object.keys(testData).forEach((key) => setFieldValue(key, testData[key]));
    betaForm.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
};

window.runBetaTestSuite = async () => {
    const caseNames = Object.keys(testCases);
    for (const name of caseNames) {
        window.runBetaTestCase(name);
        await new Promise((resolve) => setTimeout(resolve, 400));
    }
};

if (isLocalhost) {
    const panel = document.getElementById('betaTestPanel');
    if (panel) panel.style.display = 'block';
    const sendRealToggle = document.getElementById('betaTestSendReal');
    if (sendRealToggle) {
        sendRealToggle.addEventListener('change', (e) => {
            window.BETA_FORM_TEST_SEND = e.target.checked;
        });
    }
    const requiredBtn = document.getElementById('betaTestRequiredOnly');
    const allBtn = document.getElementById('betaTestAllFields');
    const whitespaceBtn = document.getElementById('betaTestWhitespace');
    const runAllBtn = document.getElementById('betaTestRunAll');
    if (requiredBtn) requiredBtn.addEventListener('click', () => window.runBetaTestCase('requiredOnly'));
    if (allBtn) allBtn.addEventListener('click', () => window.runBetaTestCase('allFields'));
    if (whitespaceBtn) whitespaceBtn.addEventListener('click', () => window.runBetaTestCase('whitespaceOptional'));
    if (runAllBtn) runAllBtn.addEventListener('click', () => window.runBetaTestSuite());
}
</script>


<section class="cta-section">
    <div class="container">
        <h2>Humanizando la atención médica</h2>
        <p>Elimina la carga administrativa y fortalece la relación médico-paciente</p>
        <a href="{{ '/acerca.html' | relative_url }}" class="btn btn-primary">Más información</a>
    </div>
</section>
